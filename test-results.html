<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results - Sarvasva Notes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Sarvasva Notes</span>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="exam-preparation.html"><i class="fas fa-fire"></i> Exam Prep</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">

        <div class="result-card text-center">
            <div class="test-hero-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <h1 class="test-hero-title">Test Completed!</h1>
            <p id="testInfo" class="test-hero-subtitle">Loading Results...</p>

            <div class="test-score-grid">
                <div class="score-box">
                    <div class="score-number" id="scorePercentage">0%</div>
                    <div class="test-score-label">Score</div>
                </div>
                <div class="score-box score-box-green">
                    <div class="score-number score-green" id="correctCount">0</div>
                    <div class="test-score-label">Correct</div>
                </div>
                <div class="score-box score-box-red">
                    <div class="score-number score-red" id="incorrectCount">0</div>
                    <div class="test-score-label">Incorrect</div>
                </div>
            </div>

            <div class="test-actions">
                <a id="retryBtn" href="#" class="btn btn-primary"><i class="fas fa-redo"></i> Retry Test</a>
                <a id="backToPapersBtn" href="#" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Papers</a>
                <a href="index.html" class="btn btn-secondary"><i class="fas fa-home"></i> Dashboard</a>
            </div>
        </div>

        <h3 class="section-title"><i class="fas fa-list"></i> Detailed Review</h3>
        <div id="questionsContainer">
            <!-- Review Items -->
        </div>

    </div>

    <footer>
        <p>© 2026 Sarvasva Notes. All Rights Reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const results = JSON.parse(localStorage.getItem('testResults'));
            if (!results) {
                window.location.href = 'exam-preparation.html';
                return;
            }

            document.getElementById('testInfo').textContent = `${results.subject} • ${results.year}`;
            document.getElementById('scorePercentage').textContent = `${results.percentage}%`;
            document.getElementById('correctCount').textContent = results.correctAnswers;

            const total = results.totalQuestions;
            const answered = Object.keys(results.answers).length;
            const incorrect = answered - results.correctAnswers;

            document.getElementById('incorrectCount').textContent = incorrect;

            // Update Navigation Buttons
            const retryUrl = `mcq-test.html?subject=${results.subject}&year=${results.year}&session=${results.session}&questions=${results.totalQuestions}`;
            const papersUrl = `question-papers.html?subject=${results.subject}`;

            const retryBtn = document.getElementById('retryBtn');
            const backBtn = document.getElementById('backToPapersBtn');

            if (retryBtn) retryBtn.href = retryUrl;
            if (backBtn) backBtn.href = papersUrl;

            const container = document.getElementById('questionsContainer');
            results.questions.forEach((q, i) => {
                const userAns = results.answers[i];
                const isCorrect = userAns === q.correct;
                const isAnswered = userAns !== undefined;

                let status = isAnswered ? (isCorrect ? 'Correct' : 'Incorrect') : 'Unanswered';
                let statusClass = isAnswered ? (isCorrect ? 'status-correct' : 'status-incorrect') : 'status-unanswered';
                let bgClass = isAnswered ? (isCorrect ? 'correct' : 'incorrect') : 'unanswered';

                const div = document.createElement('div');
                div.className = `question-review-item ${bgClass}`;
                div.innerHTML = `
                    <div class="result-header">
                        <strong class="text-secondary">Q${i + 1}</strong>
                        <span class="status-badge ${statusClass}">${status}</span>
                    </div>
                    <p class="result-question-text">${q.question}</p>
                    <div class="result-answer-box">
                        <div class="result-answer-correct">
                            <i class="fas fa-check-circle"></i> Correct Answer: ${q.options[q.correct]}
                        </div>
                        ${!isCorrect && isAnswered ? `
                            <div class="result-answer-incorrect">
                                <i class="fas fa-times-circle"></i> Your Answer: ${q.options[userAns]}
                            </div>
                        ` : ''}
                        ${q.explanation ? `
                            <div class="result-explanation-divider">
                                <strong class="text-secondary"><i class="fas fa-lightbulb icon-bulb"></i> Explanation:</strong>
                                <p class="explanation-text">${q.explanation}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        });

        function retryTest() {
            const results = JSON.parse(localStorage.getItem('testResults'));
            if (results) {
                window.location.href = `mcq-test.html?subject=${results.subject}&year=${results.year}&session=${results.session}&questions=${results.totalQuestions}`;
            } else {
                alert('Test data not found. Redirecting to papers.');
                window.location.href = 'question-papers.html';
            }
        }

        function goBackToPapers() {
            const results = JSON.parse(localStorage.getItem('testResults'));
            if (results) {
                window.location.href = `question-papers.html?subject=${results.subject}`;
            } else {
                window.location.href = 'exam-preparation.html';
            }
        }
    </script>
    <script src="theme.js"></script>
</body>

</html>