<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results - Sarvasva Notes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .result-card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }

        .score-box {
            background: #eff6ff;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid #dbeafe;
        }

        .score-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .question-review-item {
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: var(--surface);
        }

        .question-review-item.correct {
            border-left: 4px solid var(--success);
        }

        .question-review-item.incorrect {
            border-left: 4px solid var(--danger);
        }

        .question-review-item.unanswered {
            border-left: 4px solid var(--text-muted);
        }

        .status-badge {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-transform: uppercase;
        }
    </style>
</head>

<body style="min-height: 100vh;">

    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Sarvasva Notes</span>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="exam-preparation.html"><i class="fas fa-fire"></i> Exam Prep</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">

        <div class="result-card" style="text-align: center;">
            <div
                style="width: 80px; height: 80px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 1.5rem;">
                <i class="fas fa-trophy"></i>
            </div>
            <h1 style="color: var(--secondary); margin-bottom: 0.5rem;">Test Completed!</h1>
            <p id="testInfo" style="color: var(--text-muted); margin-bottom: 2rem;">Loading Results...</p>

            <div class="grid"
                style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div class="score-box">
                    <div class="score-number" id="scorePercentage">0%</div>
                    <div style="font-weight: 600; color: var(--text-muted);">Score</div>
                </div>
                <div class="score-box" style="background: #f0fdf4; border-color: #bbf7d0;">
                    <div class="score-number" id="correctCount" style="color: var(--success);">0</div>
                    <div style="font-weight: 600; color: var(--text-muted);">Correct</div>
                </div>
                <div class="score-box" style="background: #fef2f2; border-color: #fecaca;">
                    <div class="score-number" id="incorrectCount" style="color: var(--danger);">0</div>
                    <div style="font-weight: 600; color: var(--text-muted);">Incorrect</div>
                </div>
            </div>

            <div style="display: flex; justify-content: center; gap: 1rem;">
                <a id="retryBtn" href="#" class="btn btn-primary"><i class="fas fa-redo"></i> Retry Test</a>
                <a id="backToPapersBtn" href="#" class="btn btn-secondary"
                    style="background: #e2e8f0; color: var(--text-main);"><i class="fas fa-arrow-left"></i> Papers</a>
                <a href="index.html" class="btn btn-secondary" style="background: #f1f5f9; color: var(--text-main);"><i
                        class="fas fa-home"></i> Dashboard</a>
            </div>
        </div>

        <h3 class="section-title"><i class="fas fa-list"></i> Detailed Review</h3>
        <div id="questionsContainer">
            <!-- Review Items -->
        </div>

    </div>

    <footer>
        <p>© 2026 Sarvasva Notes. All Rights Reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const results = JSON.parse(localStorage.getItem('testResults'));
            if (!results) {
                window.location.href = 'exam-preparation.html';
                return;
            }

            document.getElementById('testInfo').textContent = `${results.subject} • ${results.year}`;
            document.getElementById('scorePercentage').textContent = `${results.percentage}%`;
            document.getElementById('correctCount').textContent = results.correctAnswers;

            const total = results.totalQuestions;
            const answered = Object.keys(results.answers).length;
            const incorrect = answered - results.correctAnswers;

            document.getElementById('incorrectCount').textContent = incorrect;

            // Update Navigation Buttons
            const retryUrl = `mcq-test.html?subject=${results.subject}&year=${results.year}&session=${results.session}&questions=${results.totalQuestions}`;
            const papersUrl = `question-papers.html?subject=${results.subject}`;

            const retryBtn = document.getElementById('retryBtn');
            const backBtn = document.getElementById('backToPapersBtn');

            if (retryBtn) retryBtn.href = retryUrl;
            if (backBtn) backBtn.href = papersUrl;

            const container = document.getElementById('questionsContainer');
            results.questions.forEach((q, i) => {
                const userAns = results.answers[i];
                const isCorrect = userAns === q.correct;
                const isAnswered = userAns !== undefined;

                let status = isAnswered ? (isCorrect ? 'Correct' : 'Incorrect') : 'Unanswered';
                let statusColor = isAnswered ? (isCorrect ? 'var(--success)' : 'var(--danger)') : 'var(--text-muted)';
                let bgClass = isAnswered ? (isCorrect ? 'correct' : 'incorrect') : 'unanswered';

                const div = document.createElement('div');
                div.className = `question-review-item ${bgClass}`;
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <strong style="color: var(--secondary);">Q${i + 1}</strong>
                        <span class="status-badge" style="background: ${statusColor}; color: white;">${status}</span>
                    </div>
                    <p style="margin-bottom: 1rem; font-size: 1.1rem;">${q.question}</p>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                        <div style="margin-bottom: 0.5rem; font-weight: 600; color: var(--success);">
                            <i class="fas fa-check-circle"></i> Correct Answer: ${q.options[q.correct]}
                        </div>
                        ${!isCorrect && isAnswered ? `
                            <div style="font-weight: 600; color: var(--danger);">
                                <i class="fas fa-times-circle"></i> Your Answer: ${q.options[userAns]}
                            </div>
                        ` : ''}
                        ${q.explanation ? `
                            <div style="margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid #e2e8f0; color: var(--text-main); font-size: 0.95rem;">
                                <strong style="color: var(--secondary);"><i class="fas fa-lightbulb" style="color: #f59e0b;"></i> Explanation:</strong>
                                <p style="margin-top: 0.25rem; color: var(--text-muted);">${q.explanation}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        });

        function retryTest() {
            const results = JSON.parse(localStorage.getItem('testResults'));
            if (results) {
                window.location.href = `mcq-test.html?subject=${results.subject}&year=${results.year}&session=${results.session}&questions=${results.totalQuestions}`;
            } else {
                alert('Test data not found. Redirecting to papers.');
                window.location.href = 'question-papers.html';
            }
        }

        function goBackToPapers() {
            const results = JSON.parse(localStorage.getItem('testResults'));
            if (results) {
                window.location.href = `question-papers.html?subject=${results.subject}`;
            } else {
                window.location.href = 'exam-preparation.html';
            }
        }
    </script>
</body>

</html>